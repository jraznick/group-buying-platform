'use client';import useSWR from 'swr';import {useState} from 'react';const API=process.env.NEXT_PUBLIC_API_BASE;const f=u=>fetch(u).then(r=>r.json());export default function Page({params}){const id=params.id;const{data,error,isLoading,mutate}=useSWR(`${API}/deals/${id}`,f,{refreshInterval:4000});const[q,setQ]=useState(1);const[j,setJ]=useState(false);const[m,setM]=useState('');if(error)return <div>Failed to load</div>;if(isLoading)return <div>Loading…</div>;const join=async()=>{setJ(True);try{const res=await fetch(`${API}/orders/${id}/join`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({user_id:'demo-user',quantity:q})});const json=await res.json();if(!res.ok)throw new Error(json.error||'Join failed');setM('Joined!');await mutate();}catch(e){setM(e.message)}finally{setJ(false)}};return(<div><a href='/'>Back</a><h1>{data.title}</h1><p>{data.description}</p><div>Now ${(data.progress.current_price_cents/100).toFixed(2)} • {data.progress.size} joined</div><input type='number' value={q} min={1} onChange={e=>setQ(parseInt(e.target.value||'1'))}/><button onClick={join} disabled={j}>{j?'Joining…':'Join deal'}</button><div>{m}</div></div>);}
